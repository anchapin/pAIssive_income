# Handling False Positives in Secret Detection

## Overview

This document provides guidance on handling false positives in secret detection tools like Gitleaks, which is used in our pre-commit hooks and CI/CD pipeline.

## Recent Fix: Playwright Report Files

The project recently encountered false positives in the Playwright test report files. These HTML reports contain JavaScript code that includes patterns that look like password assignments but are actually part of the minified JavaScript code generated by Playwright.

### Solution Implemented

1. Added the Playwright report directory to the allowlist in `.gitleaks.toml`:
   ```toml
   # Playwright report files (generated test reports)
   '''.*[/\\]playwright-report[/\\].*''',
   '''.*[/\\]playwright-report[/\\]index\.html''',
   '''.*ui[/\\]react_frontend[/\\]playwright-report[/\\].*''',
   ```

2. Updated the gitleaks exclude pattern in `.pre-commit-config.yaml`:
   ```yaml
   exclude: |
     (?x)^(
       # ... existing exclusions ...
       \.github/workflows/.*\.yml$|
       .*playwright-report/.*|
       .*ui/react_frontend/playwright-report/.*
     )
   ```

## How to Handle Future False Positives

If you encounter false positives in secret detection, follow these steps:

### 1. Verify It's Actually a False Positive

Before excluding any files or patterns:
- Confirm the detected "secret" is not actually sensitive information
- Check if it's part of generated code, test data, or documentation
- Ensure it doesn't contain real credentials, API keys, or tokens

### 2. Update the Allowlist in `.gitleaks.toml`

For specific file paths or patterns:
```toml
paths = [
    # ... existing paths ...
    '''.*path[/\\]to[/\\]false[/\\]positive[/\\].*''',
]
```

For specific string patterns that are falsely detected:
```toml
regexes = [
    # ... existing regexes ...
    '''pattern-that-looks-like-a-secret-but-is-not''',
]
```

### 3. Update the Pre-commit Configuration

If necessary, also update the exclude pattern in `.pre-commit-config.yaml` for the gitleaks hook:
```yaml
exclude: |
  (?x)^(
    # ... existing exclusions ...
    .*path/to/false/positive/.*
  )
```

### 4. Document Your Changes

Always document why you've excluded certain files or patterns:
- Add comments in the configuration files
- Update this document with details about significant false positive patterns
- Include information in commit messages when making these changes

### 5. Test Your Changes

After updating the configurations:
- Run `pre-commit run --all-files` to verify the false positives are no longer detected
- Ensure that legitimate secrets would still be caught by the tool

## Common False Positive Patterns

These patterns often trigger false positives but are generally safe to exclude:

1. **Generated/Minified Code**: JavaScript libraries, compiled code, and minified files
2. **Test Data**: Mock credentials used in tests (though these should use obvious fake values)
3. **Documentation Examples**: API usage examples with placeholder credentials
4. **Build Artifacts**: Generated reports, coverage data, and other build outputs
5. **Variable Names**: Code that uses words like "password" or "secret" in variable names

## Best Practices

1. **Use Obvious Placeholders**: When examples are needed, use values like `YOUR_API_KEY_HERE` or `example-password-123`
2. **Generate Test Reports in Ignored Directories**: Configure test tools to output reports to directories that are already excluded
3. **Add to .gitignore When Possible**: For build artifacts and generated files, consider adding them to `.gitignore` instead of just excluding them from secret scanning
4. **Regular Maintenance**: Periodically review and clean up exclusion lists to ensure they're not overly broad

## References

- [Gitleaks Documentation](https://github.com/gitleaks/gitleaks)
- [Pre-commit Hooks Documentation](https://pre-commit.com/)
- [Project Security Policy](./secrets_management.md)
